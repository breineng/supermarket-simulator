# Настройка многоуровневых полок в Unity

## Структура GameObject

### Основная иерархия:
```
MultiLevelShelf (GameObject)
├── ShelfFrame (визуальная модель рамы полки)
├── Level1 (GameObject с компонентом ShelfLevel)
│   ├── ShelfBoard (визуальная модель полки)
│   ├── ItemSpawnPoint1 (Transform)
│   ├── ItemSpawnPoint2 (Transform)
│   ├── ... (дополнительные точки спавна)
│   └── PriceTagPosition (Transform) - позиция для ценника
├── Level2 (GameObject с компонентом ShelfLevel)
│   ├── ShelfBoard (визуальная модель полки)
│   ├── ItemSpawnPoint1 (Transform)
│   ├── ItemSpawnPoint2 (Transform)
│   ├── ... (дополнительные точки спавна)
│   └── PriceTagPosition (Transform) - позиция для ценника
└── ... (дополнительные уровни)
```

## Настройка компонентов

### MultiLevelShelfController (на корневом объекте):
- **Shelf Levels**: Список всех ShelfLevel компонентов (автоматически найдет, если пусто)
- **Interaction Distance**: 3 (расстояние взаимодействия)

### ShelfLevel (на каждом уровне):
- **Configuration**:
  - **Max Capacity**: 10 (или другое значение в зависимости от размера полки)
  - **Item Spawn Points**: Список Transform точек для размещения товаров
- **Price Tag**:
  - **Price Tag Position**: Transform для позиции ценника
  - **Price Tag Prefab**: Ссылка на префаб ценника (Assets/Prefabs/UI/PriceTag.prefab)
- **Visual Feedback**:
  - **Highlight Material**: Материал для подсветки (опционально)
  - **Highlight Color**: Цвет подсветки (по умолчанию желтоватый)

### Настройка ценников:
1. Создайте пустой GameObject `PriceTagPosition` как дочерний объект каждого уровня
2. Расположите его там, где должен отображаться ценник (обычно спереди полки)
3. Поверните его так, чтобы ценник был направлен к покупателям
4. В компоненте ShelfLevel:
   - Перетащите `PriceTagPosition` в поле **Price Tag Position**
   - Перетащите префаб `PriceTag.prefab` в поле **Price Tag Prefab**
   - Или оставьте поле пустым - префаб загрузится автоматически

## Коллайдеры

Каждый уровень должен иметь коллайдер для определения фокуса:
- Добавьте **Box Collider** на GameObject уровня или на ShelfBoard
- Настройте размер коллайдера чтобы покрывать всю площадь полки
- Layer должен быть "Default" или другой, который обрабатывает Raycast

## Создание префаба

1. Настройте полку согласно инструкциям выше
2. Протестируйте взаимодействие в Play Mode
3. Сохраните как префаб в `Assets/Prefabs/Placeables/`
4. Используйте префаб для размещения полок в сцене

## Важные замечания

- Точки спавна товаров должны быть расположены равномерно на полке
- Коллайдеры уровней не должны пересекаться для корректного определения фокуса
- PriceTagPosition должен быть расположен так, чтобы ценник был хорошо виден
- Ценники автоматически появляются при размещении первого товара и исчезают когда полка пустеет
- Ценники автоматически обновляют цену при изменении розничных цен в системе

## Пошаговая настройка

### 1. Создание основного GameObject
1. Создайте пустой GameObject и назовите его "MultiLevelShelf"
2. Добавьте компонент `MultiLevelShelfController`
3. Добавьте компонент `Box Collider`:
   - Установите размер, чтобы охватывал всю полку
   - Убедитесь, что `Is Trigger` выключен
4. Добавьте компонент `BehaviourInject.Injector`
5. Установите тег "Shelf" (опционально, для легкого поиска)

### 2. Добавление визуальной модели
1. Добавьте 3D модель полки как дочерний объект
2. Удалите все коллайдеры с модели (если есть)
3. Убедитесь, что модель правильно позиционирована

### 3. Создание уровней полки
Для каждого уровня (полки):

1. **Создайте GameObject уровня:**
   - Создайте пустой GameObject как дочерний от MultiLevelShelf
   - Назовите его "Level1", "Level2" и т.д.
   - Позиционируйте на нужной высоте

2. **Настройте компонент ShelfLevel:**
   - Добавьте компонент `ShelfLevel`
   - Установите `Max Capacity` (например, 10)
   - Оставьте `Item Spawn Points` пустым (заполним позже)

3. **Добавьте коллайдер уровня:**
   - Добавьте `Box Collider` на GameObject уровня
   - Настройте размер, чтобы покрывал площадь этого уровня
   - Важно: коллайдер должен быть достаточно большим для raycast

4. **Создайте точки спавна товаров:**
   - Создайте пустые GameObject как дочерние от уровня
   - Назовите их "SpawnPoint1", "SpawnPoint2" и т.д.
   - Расположите их там, где должны появляться товары
   - Добавьте эти Transform'ы в список `Item Spawn Points` компонента ShelfLevel

5. **Создайте позицию для ценника:**
   - Создайте пустой GameObject "PriceTagPosition"
   - Расположите его там, где должен быть ценник
   - Назначьте его в поле `Price Tag Position` компонента ShelfLevel

### 4. Настройка MultiLevelShelfController
1. Список `Shelf Levels` должен автоматически заполниться при старте
2. Если нет, перетащите все ShelfLevel компоненты в список вручную
3. Установите `Interaction Distance` (например, 3)

### 5. Создание префаба ценника (если еще не создан)
1. Создайте GameObject с TextMeshPro компонентами для названия и цены
2. Добавьте компонент `PriceTagController`
3. Назначьте ссылки на тексты в инспекторе
4. Сохраните как префаб "PriceTag"

## Советы по настройке

### Коллайдеры
- Каждый уровень ДОЛЖЕН иметь свой коллайдер для правильного определения фокуса
- Коллайдеры уровней НЕ должны перекрываться
- Основной коллайдер на MultiLevelShelf используется для общего взаимодействия

### Расположение точек спавна
- Располагайте точки спавна равномерно
- Учитывайте размер товаров при расстановке
- Первая точка обычно слева, последняя справа

### Оптимизация
- Используйте LOD для визуальной модели полки
- Отключайте тени у мелких товаров на полках
- Используйте Object Pooling для товаров (в будущем)

## Тестирование
1. Поместите полку в сцену
2. Запустите игру
3. Возьмите коробку с товаром
4. Откройте коробку (F)
5. Наведитесь на конкретный уровень
6. Нажмите ЛКМ для размещения товара
7. Проверьте, что товар появился на правильном уровне

## Известные ограничения
- Один тип товара на уровень
- Нельзя смешивать разные товары на одном уровне
- Ценники пока нужно создавать вручную (TODO: автоматическое создание)